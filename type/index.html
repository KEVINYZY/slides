<!DOCTYPE html>
<html>
  <head>
    <title>强类型 JavaScript 的解决方案</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="../remark/remark.css" type="text/css" media="screen" />
  </head>
  <body>
    <textarea id="source">

class: center, middle

# 强类型 JavaScript 解决方案

2015.01

---

class: middel

# 三种方案

## - TypeScript

## - FlowCheck

## - Flow

---

# TypeScript

- http://www.typescriptlang.org/

- 微软推出的JavaScript超集

- 安装

```bash
$ npm install -g typescript
```

---

## 函数的类型

```javascript

// greeter.ts

// 参数 person 预期类型为字符串
function greeter(person: string) {
  console.log("Hello, " + person);
}

// 实际类型为数组
greeter([0, 1, 2]);

```

编译结果

```bash

$ tsc greeter.ts
greet.ts(5,9): error TS2345: 
Argument of type 'number[]' is not assignable 
to parameter of type 'string'.

```

---

## Interface 类型

```javascript

interface Person {
  firstname: string;
  lastname: string;
}

function greeter(person : Person) {
  return "Hello, " + person.firstname + " " + person.lastname;
}

greeter({firstname: "Jane", lastname: "User"});

```

---

## Class 类型

```javascript

class Point {
  x: number;
  y: number;

  constructor(x: number, y: number) {
    this.x = x;
    this.y = y;
  }

  getDist() { 
    return Math.sqrt(this.x * this.x + 
      this.y * this.y); 
  }
}

var p = new Point(3,4);
var dist = p.getDist();

```

---

# Flowcheck

- http://gcanti.github.io/flowcheck/

- 轻量级类型断言模块，可用于运行时。

- 安装

```bash

$ npm install -g flowcheck

```

---

## 函数的类型

```javascript

// input.js

function sum(a: number, b: number) {
  return a + b;
}

sum('hello','world')

```

编译命令

```bash

$ browserify -t flowcheck -t [reactify --strip-types] \
  input.js -o output.js

```

---

## 编译后的结果

```javascript

// outpu.js

var _f = require("flowcheck/assert");

function sum(a, b) {
	_f.check(arguments, _f.arguments([_f.number, _f.number]));
  return a + b;
}

```

运行结果

```bash

$ node output.js
// throw new TypeError(message);
            ^
TypeError: 
Expected an instance of number got "hello", 
  context: arguments / [number, number] / 0
Expected an instance of number got "world", 
  context: arguments / [number, number] / 1

```

## 其他

```javascript

// 接口的类型
type MyType = Array<number>;

// ES6 Class
class Person {
  constructor(name: string, age: number) {
    this.name = name;
    this.age = age;
  }
}

```

---

# Flow

- http://flowtype.org/

- Facebook 推出的 JavaScript 代码类型检查工作，主要用于检查 React 源码

- 安装

```bash

$ npm install --global flow-bin

```

---

## 类型推断

```javascript

// hello.js

/* @flow */

function foo(x) {
  return x*10;
}

foo("Hello, world!");

```

类型推断

```javascript

$ flow check
hello.js:7:5,19: string
This type is incompatible with
/hello.js:4:10,13: number

```

---

# 散点图（Scatter Chart）

- 适用场合：三维数据，其中由两个维度存在比较关系。

- 比如，国家医疗支出与预期寿命（维度：国名、医疗支出、预期寿命）。

![](scatter1.png)

---

## 注意点

- 用户希望知道每个点的说明（尤其是边缘点），为了反映每个点的情况，需要为它们加上“浮动提示框”，或者标识不同颜色。

![](scatter2.png)

---

# 气泡图（Bubble Chart）

- 散点图的一种变体，通过每个点的面积大小，反映三维数据。
- 示例：飓风路径（三维：经度、纬度、强度）

![](bubble1.png)

---

## 注意点

- 用户不善于判断面积大小，所以气泡图只适用不要求精确识别第三维的场合。
- 通过颜色或提示框，可用来表达四维数据（前提是其他两维不要求精确识别）。

![](bubble2.png)

---

# 雷达图（Radar Chart）

- 适用于多维数据（四维以上），且每个维度必须可以排序（比如，国籍就不可以排序）
- 数据点最多6个，否则无法辨别。因此，适用场合有限。
- 示例：某队篮球选手的数据（维度：得分、篮板、助攻、抢断、封盖）

![](radar-table.png)

---

## 注意点

- 面积越大的数据点，表示越重要。
- 用户不熟悉这种图，解读有困难。 使用时尽量加上说明，减轻解读负担。

![](radar.png)

---

class: center, middle

# END

    </textarea>
    <script src="../remark/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>

